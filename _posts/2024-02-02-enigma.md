---
layout: post
title: "Desvendando a Enigma: Implementa√ß√£o, Ataques Modernos e sua Hist√≥ria."
date: 2024-02-2 10:40:00
description: Material Did√°tico sobre a Enigma, incluindo Gillogly's Attack.
tags: Enigma
categories: Intermedi√°rio
---

## Introdu√ß√£o - O que √© a Enigma?

Criada pelo alem√£o Arthur Scherbius, a Enigma foi a m√°quina eletromec√¢nica de criptografia adotada pela Alemanha na Segunda Guerra Mundial. Ela foi inicialmente projetada para ser uma m√°quina de cifras para civis, contudo, no final da d√©cada de 20 ela sumiu do mercado, que interessou os militares.

Assim, com a chegada da Segunda Guerra Mundial, ambos os lados viram a necessidade de implementar m√©todos mais seguros de criptografia para que as comunica√ß√µes entre r√°dios e outras comunica√ß√µes militares n√£o pudessem ser facilmente interceptadas e decifradas.

Ao longo da Guerra, muitos pesquisadores aliados estiveram envolvidos na solu√ß√£o da Enigma, ou melhor, nas t√©cnicas de decripta√ß√£o das mensagens intereceptadas. Suas pesquisas se baseavam em ‚ÄòKPA‚Äô - ‚ÄúKnown-plaintext attack‚Äù, provalmente porque as mensagens interceptadas se limitavam a somente 200 caracteres, o que dificultaria um ataque ‚Äúciphertext only‚Äù, ao menos era o que deveria acontecer.

## Os Mecanismos da Enigma

### 1. Uma Breve Descri√ß√£o

Ao longo dos anos, a m√°quina Enigma assumiu algumas formas, contudo as altera√ß√µes n√£o mudaram muito seu escopo observ√°vel, mantendo assim a apar√™ncia de uma caixa registradora com uma m√°quina datilogr√°fica.

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid path="assets/img/Enigma/Enigma-plugboard.jpg" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

 Ela era formada por 5 componentes:

- Teclado
- Plugboard
- Rotores
- Refletor
- L√¢mpadas

Assim, o operador pressionava uma tecla, fazendo com que a corrente el√©trica passasse para o *plugboard*, em seguida pelos 3 *rotores*, da direita para a esquerda, e *refletor*, nessa sequ√™ncia. E como o nome j√° diz, o refletor, com sua pr√≥pria permuta√ß√£o, fazia com que a corrente realizasse o caminho inverse at√© chegar na *lampboard*, iluminando o caractere obtido.

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid path="assets/img/Enigma/enigma.gif" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

### 1.1. Teclado e L√¢mpadas

O teclado e as l√¢mpadas representam, respectivamente, o *input* e o *output* de um caractere na m√°quina Enigma. Na vers√£o original, a Enigma possui 26 l√¢mpadas representando as letras do alfabeto, o mesmo vale para o teclado.

Quando o processo se encerra, a l√¢mpada acende com a letra encriptada.

### 1.2. Plugboard

A Plugboard √© o √∫nico mecanismo que s√≥ existe na vers√£o militar da Enigma, 

Esse elemento permitia a altera√ß√£o manual de pares de letras entre si - a parte monoalfabetica da cifra -  embaralhando o Alfabeto, e portanto, a mensagem. Essa funcionalidade se dava por cabos com ‚Äòjacks‚Äô nas pontas que conectavam as duas letras em quest√£o.

Esse mecanismo permitia uma permuta√ß√£o adicional antes da entrada nos rotores, adicionando uma camada extra de complexidade √† criptografia.

Assim, caso o par ‚ÄúAZ‚Äù fosse escolhido, o sinal ‚ÄúA‚Äù passaria do teclado para a plugboard, que ent√£o se tornaria ‚ÄúZ‚Äù e o mesmo vale no caminho inverso.

### 1.3. Rotores

Os rotores eram o cora√ß√£o da Enigma. Eles eram discos circulares que contavam com 26 contatos el√©tricos dos dois lados, e cada contato era conectado ‚Äúaleatoriamente‚Äù a outro do lado oposto.

Quando uma tecla do Teclado era pressionada, uma corrente el√©trica passava do primeiro rotor, que girava para uma posi√ß√£o diferente. Assim, a corrente el√©trica fluia por um conjunto diferente de contatos, embaralhando a mensagem.

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid path="assets/img/Enigma/Clock.gif" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
A Enigma possuia 8 possibilidades de rotores e cada um deles mapeava uma letra do alfabeto para um outra. Esse mapeamento √© chamado de Permuta√ß√£o ou Wiring. 

Abaixo est√£o representadas essas permuta√ß√µes:

- Rotor I : EKMFLGDQVZNTOWYHXUSPAIBRCJ   Notch: Q
- Rotor II : AJDKSIRUXBLHWTMCQGZNPYFVOE   Notch: E
- Rotor III : BDFHJLCPRTXVZNYEIWGAKMUSQO   Notch: V
- Rotor IV : ESOVPZJAYQUIRHXLNFTGKDCMWB   Notch: J
- Rotor V : VZBRGITYUPSDNHLXAWMJQOFECK   Notch: Z
- Rotor VI : JPGVOUMFYQBENHZRDKASXLICTW   Notches: Z+M
- Rotor VII : NZJHGRCXMYSWBOUFAIVLPEKQDT   Notches: Z+M
- Rotor VIII : FKQHTLXOCBJSPDZRAMEWNIUYGV   Notches: Z+M

### 1.3.1. Notches:

Talvez a melhor maneira de se entender o funcionamento do Notch seja com uma alus√£o ao Rel√≥gio.

O Ponteiro dos Segundos precisa dar uma volta completa (60s) no rel√≥gio para que o Ponteiro dos Minutos mova uma posi√ß√£o e esse por sua vez precisa dar uma volta completa (60 min) para que o Ponteiro das Horas mova uma posi√ß√£o.

Assim, para que o ponteiro das horas mova uma posi√ß√£o, o Ponteiro dos Segundos precisa realizar 60 voltas completas, que √© equivalente a 3600 segundos.

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid path="assets/img/Enigma/Clock.gif" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

Voltando para os rotores, em uma configura√ß√£o de rotores I-II-III, em que a corrente vem da plugboard para o rotor III. 

Para que o rotor II mova uma posi√ß√£o, eu preciso que o rotor III chegue no notch (letra V), que no caso do rel√≥gio eram 60 voltas completas com ponteiro iniciando no 12.

Assim, quando o rotor III estiver na posi√ß√£o ‚ÄúV‚Äù, a pr√≥xima letra digitada far√° com que o rotor II mova uma posi√ß√£o. 

Cada rotor possui um notch diferente e por volta de 1941, tr√™s rotores foram introduzidos com dois notches, ou seja, faria com que o pr√≥ximo rotor girasse o dobro de vezes.

### 1.3.2. Rings:

A configura√ß√£o dos ‚ÄòRings‚Äô ou An√©is afetava o mapeamento interno dos rotores e por sua vez, o notch. 

Esse anel era um c√≠rculo que ficava ao redor do rotor contendo o alfabeto impresso. Assim, era poss√≠vel rotacionar esse alfabeto alterando a permuta√ß√£o interna dos rotores.

Caso a ‚ÄòRing Setting‚Äô do rotor de tipo IV fosse 2, o Notch seria alterado de ‚ÄúJ‚Äù para ‚ÄúH‚Äù.

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid path="assets/img/Enigma/exploded.gif" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
Visualiza√ß√£o de um Rotor e suas componentes. Retirado do CryptoMuseum.

### 1.4. Refletor

Em seguida, temos o Refletor, que tamb√©m possui 26 contatos de um lado. Entretanto, ao contr√°rio dos Rotores, um contato √© conectado a outro do mesmo lado, retornando a corrente para fazer o caminho inverso at√© as l√¢mpadas. 

A Enigma possu√≠a tr√™s tipos de refletores, representados por:

- A : EJMZALYXVBWFCRQUONTSPIKHGD
- B : YRUHQSLDPXNGOKMIEBFZCWVJAT
- C : FVPJIAOYEDRZXWGCTKUQSBNMHL

Para ilustrar:

Em uma m√°quina Enigma equipada com um refletor do tipo B, quando o sinal correspondente a letra ‚ÄúA‚Äù chegava do rotor esquerdo para o refletor, o sinal passado de volta seria a letra ‚ÄúY‚Äù.

Por causa desse componente que a m√°quina era capaz de tanto encriptar mensagens quanto decript√°-las, at√© porque cada letra segue um caminho sim√©trico.

### 2. Configura√ß√£o Di√°ria

A Enigma operava todo dia com uma configura√ß√£o diferente, e essas eram anotadas em uma folha de papel com tinta sol√∫vel. Todo m√™s os operadores recebiam uma folha nova contendo 30 dias de configura√ß√µes, e em eventuais perdas, novas combina√ß√µes eram selecionadas. 

Essas configura√ß√µes eram as posi√ß√µes iniciais dos rotores, as posi√ß√µes dos an√©is, os rotores escolhidos e as conex√µes da plugboard.

![Folha das configura√ß√µes pertencente a For√ßa A√©rea Alem√£ de n√∫mero 2744.](Desvendando%20a%20Enigma%20Implementac%CC%A7a%CC%83o,%20Ataques%20Mode%20bbb34c806dce4b59854c956db0a71dfb/lw_key_2744_full.jpg)

Folha das configura√ß√µes pertencente a For√ßa A√©rea Alem√£ de n√∫mero 2744.

Um exemplo de Configura√ß√£o Di√°ria seria:

Rotores - IV I III

Posi√ß√£o de Rotores - CAT

Posi√ß√£o dos An√©is - 01 25 04

Conex√µes da Plugboard - AB DF UW CK LR

Cada mensagem come√ßava com os *indicadores,* que eram tr√™s letras escolhidas pelo operador, ou seja, antes de inserir a mensagem desejada, os operadores configuravam a Enigma conforme a folha e digitavam, por exemplo, DOG DOG, que seriam encriptadas para outras 6 letras inseridas no topo da mensagem.

### 3. As Equa√ß√µes da Enigma

### 3.1. A Enigma:

O mecanismo da m√°quina Enigma simplificado pode ser descrito pela seguinte equa√ß√£o:

$$
cifra = P_{lugboard} (R_{3}^{-1} (R_{2}^{-1}(R_{1}^{-1}(R_{efletor}(R_{3}(R_{2}(R_{1}(P_{lugboard}(letra))))))))),
$$

onde $R_{i},  i\in\N^{*}$ s√£o os rotores.

Perceba que nesta equa√ß√£o, ap√≥s o sinal passar do Refletor, os rotores recebem a nota√ß√£o de inverso. Isso ocorre, porque no caminho de volta do sinal a permuta√ß√£o do rotor utilizada √© a inversa.

### 3.2. Rotores:

### 3.2.1. Encriptar:

Uma letra encriptada por um rotor recebe:

$$
c =(R[(letra+r) \mod 26] -r) \mod 26,
$$

onde $r$ √© a rota√ß√£o, que, logicamente, $r \in [0, (n-1)]$, para $n$ o tamanho do m√≥dulo 

e $R$ √© o array de int obtido pelo pseudo-c√≥digo abaixo:

```java
para cada char pertencente a char[] Permutacao
		R_i <- char-65  // Tabela ASCII
// OBS: O char letra, correspondente a letra a ser encriptada
// tamb√©m √© convertida para inteiro.
```

Vale relembrar, que conforme explicitado em 3.1, o array R quando est√° no caminho de volta √© a Permuta√ß√£o Inversa $(R^{-1})$.

Quando a configura√ß√£o de anel √© diferente de 0, a equa√ß√£o pode ser vista como:

$$
c=(R[(p+pos-ring)\mod 26] - pos +ring) \mod 26
$$

### 3.2.2. Movimentar:

Como a permuta√ß√£o de cada rotor j√° est√° armazenada em um array de int, para girar um desses rotores, basta realizar:

$$
posRotor_{i+1} = (posRotor_{i} + 1) \mod 26
$$

### 3.3. Testes de Mensagem:

Para testar o funcionamento da Enigma implementada, √© necess√°rio escolher as configura√ß√µes iniciais dos rotores, rings e as conex√µes da plugboard e cifrar um texto arbitr√°rio.

A mensagem original √© obtida de volta quando se encripta a cifra com as mesmas configura√ß√µes iniciais em que a mensagem foi encriptada.

Dada a mensagem $m =\ "GRISUFRJ"$, o teste ser√° encriptar m com as seguintes condi√ß√µes: 

$Rotores=(I,II,III), \ Keys=(E,D,P), \ Rings=(4,3,14) \ e \ Plugboard=(AB, EH, JD)$.

![ENIGMA_TEST1.png](Desvendando%20a%20Enigma%20Implementac%CC%A7a%CC%83o,%20Ataques%20Mode%20bbb34c806dce4b59854c956db0a71dfb/ENIGMA_TEST1.png)

## Quebrando a Enigma

### 4. A Trajet√≥ria das Solu√ß√µes

### 4.1. The Cipher **Bureau**

Em 1928, o ex√©rcito alem√£o come√ßou a realizar testes no suposto novo sistema de criptografia. Ap√≥s o t√©rmino da Primeira Guerra Mundial, a Fran√ßa e a Gr√£-Bretanha n√£o pensavam que a Alemanha seria uma amea√ßa, contudo a Pol√¥nia se manteve cautelosa.

Ent√£o, o Servi√ßo Secreto Polon√™s organizou um curso em Criptoan√°lise para estudantes de Matem√°tica na Universidade de Poznan. O curso foi ministrado pelo professor Zdzis≈Çaw Krygowski em 1929 para os tr√™s alunos que mais se destacavam, eram eles: Marian Rejwski, Henryk Zygalski, Jerzy R√≥zycki. Com o t√©rmino do curso, os tr√™s aceitaram a proposta para trabalhar na an√°lise dessa nova m√°quina de criptografia.

![Marian Rejwski, Henryk Zygalski e Jerzy R√≥zycki, da esquerda para a direita.](Desvendando%20a%20Enigma%20Implementac%CC%A7a%CC%83o,%20Ataques%20Mode%20bbb34c806dce4b59854c956db0a71dfb/Polish.png)

Marian Rejwski, Henryk Zygalski e Jerzy R√≥zycki, da esquerda para a direita.

De in√≠cio, v√°rios testes estat√≠sticos foram realizados nas cifras intereceptadas, e pelo ‚Äú√çndice de Coincid√™ncia‚Äù, que ser√° abordado com mais detalhes, conseguiram determinar que essas mensagens muito provavelmente vieram de uma cifra polialfab√©tica, como a [cifra de Vigen√®re](https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher).

O sistema de criptografia at√© ent√£o estudado s√≥ foi identificado como uma vers√£o da m√°quina Enigma por causa de um Espi√£o Alem√£o apelidado de ‚ÄúAsche‚Äù, que trabalhava em uma ag√™ncia de criptografia. Asche, ent√£o, passou as informa√ß√µes para a a intelig√™ncia Francesa com provas documentadas em troca de dinheiro, que por sua vez compartilhou esse material com os Brit√¢nicos e os Polon√™ses.

Em 1932, o matem√°tico polon√™s Marian Rejwski conseguiu determinar o mapeamento interno dos rotores da Enigma Militar. Ele percebeu que esse mapeamento pode ser descrito como um Grupo de Permuta√ß√£o, que n√£o ser√° aprofundado nesse artigo (talvez futuramente?).

Assim, em 1934 foi criado o [‚ÄòCyclometer‚Äô](https://en.wikipedia.org/wiki/Cyclometer), que se baseava no fato das tr√™s primeiras letras de uma dada cifra, serem id√™nticas √†s pr√≥ximas tr√™s, que formavam a ‚ÄòMessage Key‚Äô. Essa m√°quina era capaz de retornar uma lista com mais de 100.000 ‚Äòcycle entries‚Äô, que eram as ‚ÄòMessage Keys‚Äô.

Em 1938, Henryk Zygalski criou as [‚ÄúZygalski Sheets‚Äù](https://en.wikipedia.org/wiki/Zygalski_sheets) que era uma solu√ß√£o baseada em papel (folhas perfuradas), que tamb√©m dependia das tr√™s primeiras letras de uma mensagem serem id√™nticas √†s pr√≥ximas tr√™s.

Esse ataque funcionou at√© 1938, quando o ex√©rcito alem√£o alterou seu modo de opera√ß√£o de uso da Enigma.

Ent√£o, a equipe construiu a [‚ÄúBomba Kryptologiczna‚Äù](https://en.wikipedia.org/wiki/Bomba_(cryptography)), que procurava por configura√ß√µes em que a primeira e quarta letra da mensagem fossem iguais, devido ao mesmo fator explorado acima. Em termos de desempenho, essa m√°quina era capaz de encontrar a solu√ß√£o em 110 minutos, isso √©, antes dos Alem√£es introduzirem dois novos rotores ( IV e V ) em 1939. Apesar do tempo da solu√ß√£o ser inferior a duas horas, eram necess√°rias 60 Bombes para recuperar a mensagem original, o que era extremamente caro de se produzir.

Assim, sua pesquisa foi passada para os Brit√¢nicos para que continuassem √† procurar maneiras de eficientemente decriptar as mensagens interceptadas.

### 4.2. Bletchley Park

Assim como a Pol√¥nia, os ingleses come√ßaram a busca por matem√°ticos para trabalhar no Government Code and Cipher School (GC&CD). Localizado no Bletchey Park, trabalhavam nesse projeto Dilly Knox e Tony Kendrick, que foram acompanhados em seguida de Peter Twinn, Gordon Welchman e Alan Turing. 

![Harold ‚ÄòDoc‚Äô Keen, Alan Turing e Gordon Welchman, da esquerda para a direita.](Desvendando%20a%20Enigma%20Implementac%CC%A7a%CC%83o,%20Ataques%20Mode%20bbb34c806dce4b59854c956db0a71dfb/BritshEnigma.png)

Harold ‚ÄòDoc‚Äô Keen, Alan Turing e Gordon Welchman, da esquerda para a direita.

Depois que os Alem√£es mudaram a forma que as Message Keys eram geradas, Alan Turing otimizou a solu√ß√£o dos polacos da ‚ÄòBomba Kryptologiczna‚Äô para que procurassem por peda√ßos de textos conhecidos na mensagem original ao inv√©s das ‚ÄòMessage Keys‚Äô. Esse ataque √© conhecido como ‚ÄúKnown-Plaintext‚Äù. 

Diferentemente da ‚ÄòBomba‚Äô dos Polacos que testavam rotores que se encaixavam com a ‚ÄòMessage Key‚Äô, a m√°quina criada por Turing testava todas as configura√ß√µes poss√≠veis, procurando as que permitiam a cifra conter a mensagem desejada. Essa solu√ß√£o ser√° abordada com mais detalhes no t√≥pico 5.1.

Enquanto isso, Gordon Welchman procurou solu√ß√µes baseadas nas Folhas Perfuradas de Henryk Zygalski para a Plugboard. Esse estudo resultou na ‚ÄúDiagonal Board‚Äù, que conectava todas as letras  $(\# L)$ √† todas as outras letras $(\#L-1)$. 

As Bombes desenvolvidas por Turing juntamente com a Diagonal Board de Welchman, reduziram significativamente (em milhares) o n√∫mero de configura√ß√µes de rotores a serem analisados. 

A partir desse design, o engenheiro Harold ‚ÄúDoc‚Äù Keen, que trabalhava na ‚ÄúBritish Tabulating Machines‚Äù (BTM) ficou respons√°vel por construir essa m√°quina. Doc j√° havia come√ßado a construir a m√°quina de Turing, e com esse novo design de Welchman ele precisou ajustar esse novo maquin√°rio, que ficou conhecido como Bombe. Ao longo da Guerra, foram constru√≠das mais de 200 Bombes na Inglaterra.

As Wrens (‚ÄôWomen‚Äôs Royal Naval Service‚Äô) eram respons√°veis por operar essas m√°quinas, passando para os criptoanalistas os resultados, que por sua vez conferiam se a configura√ß√£o era correta e passavam outra mensagem para as operadoras.

[https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR6eibbgfRqIwS7Ntnjb6d5CpK0-SOPEyRxoNsrVj5P3wP7fmC-FLb4qU6InVKfdrhAviU&usqp=CAU](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR6eibbgfRqIwS7Ntnjb6d5CpK0-SOPEyRxoNsrVj5P3wP7fmC-FLb4qU6InVKfdrhAviU&usqp=CAU)

### 5. Problemas da Enigma

### 5.1. Uma letra nunca √© encriptada para ela mesma

(Exemplo Retirado de Numberphile).

Essa caracter√≠stica possibilitou que ataques de known-plaintext fossem realizados, uma vez que um Crib (peda√ßo de texto que voc√™ sabe que pertence √† mensagem) est√° em uma cifra onde as letras nunca s√£o elas mesmas.

> Cipher: J X A T Q B Q G Y W C R Y B G D T

Crib:       W E T T E R  B E  R I C H T
> 

Passando o ‚Äòcrib‚Äô pela mensagem encriptada, encontramos essa posi√ß√£o, em que h√° a possibilidade de ser a posi√ß√£o em que o Crib se encontra.

> Cipher: J X A T Q B Q G Y W C R Y B G D T

> Crib:         W E T T E R B E R I C H T


A m√°quina de Turing-Welchman possibilitava a dedu√ß√£o das conex√µes da Plugboard por causa dessa caracter√≠tisca. Vejamos no exemplo, a letra T passa pela plugboard, rotores, refletor e realiza o caminho de volta at√© chegar na lampboard como a letra E.

A Bombe d√° um palpite de uma conex√£o na plugboard com a letra T, digamos o par ‚ÄúAT‚Äù.

Descobrir o resultado final depois da letra T, agora A, passar pelos rotores √© relativamente f√°cil com a m√°quina construida, ent√£o, assuma que o resultado antes da volta da plugboard seja a letra P.

Isso significa que P estaria conectado a letra E, pois o √∫ltimo elemento que poderia alterar a letra P para E, seria uma conex√£o na plugboard de volta e com o chute inicial prosseguimos na procura dessas conex√µes. 

A letra T passa pelas componentes da Enigma e antes de virar Q, ela √© K, logo K e Q est√£o conectadas. O mesmo racioc√≠nio se aplica para T e B, obtendo-se o par XB.

Contudo, quando a letra T √© encriptada para G, antes de passar pelos rotores no caminho inverso, ela tem forma ‚ÄúT‚Äù e a √∫nica conex√£o que possibilitaria funcionar, seria o par TG, o que √© uma contradi√ß√£o, visto que T j√° est√° conectado com A e uma mesma letra n√£o pode ter duas conex√µes distintas. Logo, o par AT n√£o est√° conectado na plugboard.

Como todas essas conex√µes vieram de uma id√©ia errada, todas elas podem ser descartadas e n√£o precisam ser checadas novamente, economizando muito tempo de processamento.

Curiosidade: Ap√≥s o fim da Guerra, os Brit√¢nicos criaram uma m√°quina baseada na Enigma corrigindo essa falha, se chama TypeX.

### 5.2. An√©is n√£o acrescentam tanta seguran√ßa

Dada uma mensagem C, ap√≥s um estudo em Criptoan√°lise foram descobertos os rotores escolhidos. Se colocados na ordem em que a mensagem foi encriptada e o anel do rotor direito estiver errado, algumas partes da mensagem ainda s√£o leg√≠veis. 

Lembrando que o rotor direito √© o mais r√°pido, ou seja, o rotor em que a Ring Setting mais afetaria o resultado. Tanto que no ataque brute-force implementado (que veremos depois), o anel esquerdo sempre ser√° zero, j√° que pro anel do meio afetar dr√°sticamente a mensagem, ela deve ter no m√≠nimo $26\cdot 25=650$ letras.

### 6. **Gillogly‚Äôs** Attack

Esse ataque brute-force foi publicado em 1995 na Cryptologia por Ph.D. James J. Gillogly.

Ele consiste em encontrar as componentes da enigma utilizadas e na ordem que melhor se encaixam individualmente atrav√©s de testes estat√≠sticos.

Como durante a Segunda Guerra um ataque brute-force ciphertext only n√£o era vi√°vel, tanto pelos tamanhos das mensagens que deveriam ser curtas (apesar dessa restri√ß√£o ter sido desrespeitada diversas vezes) quanto pelo poder computacional da √©poca, as solu√ß√µes vistas anterioemente se baseavam em known plaintext attacks. Com o poder computacional atual e com mensagens de tamanho arbitrariamente grande, √© poss√≠vel implementar um ataque ciphertext only. 

### 6.1. Quantidade de Configura√ß√µes:

Para dar uma no√ß√£o de como se daria a quantidade de diferentes configura√ß√µes podem ser utilizadas:

- Uma m√°quina Enigma cont√©m 3 rotores funcionando simultaneamente, logo devem ser escolhidos 3 de 8 rotores dispon√≠veis, o que √© equivalente a um arranjo simples.
    
    $$
    A_{8,3}=\frac{8!}{(8-3)!}=8\cdot7\cdot6=336
    $$
    
- Para cada escolha de rotores, devem ser testadas 26 posi√ß√µes iniciais, que √©:

$$
26\cdot26\cdot26=17576
$$

- Al√©m disso, para cada uma dessas possibilidades acima, as configura√ß√µes de an√©is deveriam ser checadas. Contudo, como j√° foi explicitado nos problemas da enigma, podemos ignorar pelo menos o anel do rotor esquerdo e mant√™-lo como zero, o que resulta em:

$$
1\cdot26^2=676
$$

- Por fim, devemos encontrar as conex√µes na Plugboard, que no m√°ximo tem 10 pares conectados. Sabemos ent√£o, que:
    1. 6 letras n√£o est√£o conectadas
    2. A ordem dos pares agrupados n√£o importa : (Par1, Par2, ‚Ä¶, Par10) = (Par10, Par1, ‚Ä¶, Par2)
    3. A ordem em que as letras s√£o conectadas tamb√©m n√£o importa (‚ÄùAB‚Äù = ‚ÄúBA‚Äù)
    
    Assim, obtemos:
    
    $$
    \frac{26!}{6!\cdot10!\cdot2^{10}}=150738274937250
    $$
    

O total de possibilidades torna a checagem de cada uma das configura√ß√µes imposs√≠vel. Felizmente, esse n√∫mero astron√¥mico pode ser reduzido com ferramentas estat√≠sticas, filtrando os melhores resultados em cada etapa.

### 6.2. √çndice de Coincid√™ncia:

O √≠ndice de coindic√™ncia, ou teste Kappa, √© definido pela probabilidade de escolher duas letras iguais de uma mesma mensagem encriptada, seja ela uma cifra mono ou polialfab√©tica.

A sua f√≥rmula √© facilmente obtida:

$$
IoC=\frac{n_a}{N}\cdot\frac{(n_a-1)}{(N-1)} + \frac{n_b}{N}\cdot\frac{(n_b-1)}{(N-1)}+\frac{n_c}{N}\cdot\frac{(n_c-1)}{(N-1)}+\ldots +\frac{n_z}{N}\cdot\frac{(n_z-1)}{(N-1)}

$$

onde $n_i$ representa a frequ√™ncia da letra $i$ na cifra e $N$ representa o tamanho da mensagem.

Assim, a f√≥rmula pode ser reduzida a:

$$
IoC=\frac{\displaystyle\sum _{i=a}^{z}n_{i}(n_i-1)}{N(N-1)}
$$

Foi atrav√©s dessa ferramenta que os polacos foram capazes de descobrir que se tratava de uma cifra polialfab√©tica, *mas como?*

### 6.2.1. Cifra Monoalfab√©tica x Cifra Polialfab√©tica:

As frequ√™ncias de letras em uma cifra monoalfab√©tica s√£o muito vol√°teis, algumas apresentam altas frequ√™ncias e outras muito baixas, enquanto as frequ√™ncias de uma cifra polialfab√©tica tendem a se manter pr√≥ximas umas das outras, ou seja, uma distribui√ß√£o mais suave.

Assim, dado um texto em ingl√™s, sua cifra polialfab√©tica tende a aproximadamente 0.0380, enquanto uma monoalfab√©tica chega a 0.0656 aproximadamente.

![Distribui√ß√£o de frequ√™ncias na l√≠ngua inglesa.](https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/English_letter_frequency_%28alphabetic%29.svg/1024px-English_letter_frequency_%28alphabetic%29.svg.png)

Distribui√ß√£o de frequ√™ncias na l√≠ngua inglesa.

### 6.3. Trigram:

O trigram √© um caso de N-gram, que √© usado para processamento de linguagem natural em an√°lise est√°tistica de textos. O trigram procura responder a seguinte pergunta: qual a probabilidade de ocorrer uma sequ√™ncia espe√≠fica de tr√™s elementos consecutivos no texto?

Ent√£o, em termos de probabilidade, dado dois termos anteriores $\omega_1, \omega_2$, qual a probabilidade do pr√≥ximo ser $\omega_3$?

$$
P(\omega_1,\omega_2,\omega_3)=\prod_{i=3}P(\omega_3|\omega_1,\omega_2)
$$

$$
P(\omega_i|\omega_{i-1},\omega_{i-2})=\frac{count(\omega_{i-2},\omega_{i-1},\omega_i)}{count(\omega_{i-2},\omega_{i-1})}
$$

O modelo escolhido para a an√°lise estat√≠stica da mensagem encriptada foi retirado do site [PracticalCryptography](http://practicalcryptography.com/cryptanalysis/letter-frequencies-various-languages/english-letter-frequencies/).

### 6.5. Ordem dos Rotores:

De √≠nicio, a Enigma deve manter os an√©is em (0,0,0) e a plugboard sem conex√µes.

Para cada uma das 336 op√ß√µes de rotores dispon√≠veis, come√ßa a busca por suas posi√ß√µes iniciais.

A configura√ß√£o que melhor atende √† mensagem ser√° obtida ao encriptar novamente a mensagem e calcular o √çndice de Coincid√™ncia dessa nova cifra.

Por minha escolha, mantive os 3 melhores resultados e seus poss√≠veis plaintexts.

Observe que, por come√ßar com an√©is em $(0,0,0)$ o c√≥digo tentar√° ajustar as posi√ß√µes iniciais compensando os an√©is.

### 6.6. Ordem dos An√©is:

Com os 3 melhores rotores e respectivas posi√ß√µes iniciais, procuramos pelos an√©is que mais aproximam a mensagem encriptada de uma l√≠ngua natural.

Conforme falado na se√ß√£o 6.1, a busca pelo anel do rotor esquerdo √© desnecess√°ria, visto que ele quase nunca roda, ficando ent√£o com a busca de 676 diferentes posi√ß√µes de an√©is, totalizando:

$$
3\cdot676=2028
$$

Novamente, utiliza-se o √çndice de Coincid√™ncia e classifico novamente em rela√ß√£o sua pontua√ß√£o. Contudo, diferentemente da busca dos rotores, √© poss√≠vel descobrir sua pontua√ß√£o em IoC individualmente.

Configure os an√©is para $(0,0,i)$, onde $i$ √© o anel correspondente ao √≠ndice do la√ßo ‚Äòfor‚Äô e inicie a busca pelo melhor anel para o rotor direito e mantenha o valor de $i$ que melhor pontuou no √≠ndice de coincid√™ncia, aqui armazenaremos ele como $i_{bestScore}$.

Para o segundo anel, utilize outro la√ßo ‚Äòfor‚Äô passando agora pelo rotor do meio com configura√ß√£o de anel $(0, j, i_{bestScore})$ e de novo encripte a mensagem com a configura√ß√£o correspondente e mantenha o valor $j$ com melhor pontua√ß√£o.

<aside>
üí° Caso ache adequado, o IoC pode ser substitu√≠do pelo Bigram. 
O modelo pode ser encontrado juntamente com o do Trigram que falei acima.

</aside>

### 6.7. Conex√µes da Plugboard:

O passo final do algoritmo recebe a melhor configura√ß√£o de Enigma at√© ent√£o e procura por conex√µes que aumentam sua pontua√ß√£o no Trigram.

A fun√ß√£o que eu implementei recebe como par√¢metro a quantidade de conex√µes desejada, mas caso desejar pode manter o valor m√°ximo 10 como padr√£o.

Em um la√ßo de $n_{conex√µes}$ itera√ß√µes, procuro o conector com melhor pontua√ß√£o no Trigram e mantenho essa conex√£o na Enigma, ou seja, em cada itera√ß√£o um par de letras √© escolhido e ‚Äòplugado‚Äô na Enigma virtual, sempre em busca de um conector que melhore sua pontua√ß√£o.

### 6.7. Resultados:

A mensagem encriptada √©:

<aside>
‚ùì FXXUKZEPMPCJWZVYXRFPZYZPJFTBUDOIVKATVIFZZWKYSXASNIBMUIYOYTUFTZBWEQTNPLJBDKPUAKCKKYLIDUIKHOUVMQRZFDKXIGUNWAABMNAUAJNTHPPENQMAWKOSHVUJLPVWYNCLCJGDUWBMFKCCMRLDZAZKMOMOVOKNSLWKACJPBFKMFTLSXREIMOGGXITTCYPVSSJTOETFGNJCIRQPSOOXGFAWYIHDLVTXNYBJZEL
// IoC = 0.03748, confirmando que √© uma cifra polialfab√©tica

</aside>

### 6.7.1. Rotores:

<aside>
‚ùì 1¬∫ PLACE
IOC: 0.053022046
BEST KEYS: [K, A, A]
ROTORS: [III, II, IV]
POSSIBLE PLAIN TEXT: POLISXSILBRITISESOLUTIONSTOHNJRUSIMAGHRMDNHNIGKDHNIGMDTRDKFGLYURBRKUIKKZYIDJLNKDIUMLAQOMMDINTHXTDYTDCKSTEWTOTIOWVRINMWDGKNOLNTERXUGEBRIQAKGNTCRRPTDNDLYSISBRTIHPOQXQWMDTEHMDWICIDNMDRIDNRHPNISKIDNALDTHRTEROUYECDPTURZYAODVDLHVIGMKMNIGMDROTOBS
// Como utilizei poucas conex√µes de plugboard, partes do texto j√° s√£o identific√°veis

2¬∫ PLACE
IOC: 0.047958933
BEST KEYS: [I, T, I]
ROTORS: [V, IV, II]
POSSIBLE PLAIN TEXT: WHENHDNHPIRCPDZRIXNZJHTRAIOHAHQHZVKLHRMHIHUPWOJDGCSJAHUWHIGHWKMHQVHFWVIJVXIFWIJHNXYYNOQUXRJHIHMKRWGWBFCTMQEVOVOMZGGHULRIXJVCKGIBGMABSICSIEMVDRHHIXHNXHRDQTNGNSKHIAHUSUGRIOJRCIQHGHZQLRHRWOBHSXXVYXBGFBNYCQMUUGPXCTDWGIEOAIPAOGTGGCCOPQQLPBPGJCW

3¬∫ PLACE
IOC: 0.04771281
BEST KEYS: [C, I, Z]
ROTORS: [II, III, V]
POSSIBLE PLAIN TEXT: IHPONCOQQQJCSEZCUDGZWTPRPEMMIBBPERUEOAATCPJMPQIAJEFOBQUBBORVVICGBMLCNVFWAJJPCISWIVVARLEUECIQWLESOPGPYQQTRIBPPTJFDBBEUBBQEECJYXGKATPBCONBJJSREYZCQEPOJEQARGJIJJDXSKFXQIDIOCQJGJLQRACFJJPNQOTGBZOQEBBJMLBBNJVFHDSPLUGVOIIICREVJXWCIROCINZTRIDPVMQ

</aside>

### 6.7.2. An√©is:

<aside>
‚ùì 1¬∫ PLACE
ROTORS: [III, II, IV]
KEY: [K, A, A]
BEST RINGS: [1, 2, 5]
SCORE: 0.056362294
POSSIBLE PLAIN TEXT: POLISETNABRITISESOLUTIONSTOHNJRYPTRAGHRMDNHNIGKDHNIGMDTRDFFICRHLCHAONSOPZISTXCDTHAKNHWNPMDINTHXTDYTDCKSTEWTOTOYWVRINMWDGKNOLNTERXUGEBRILLIDNTCRRPTDNDLYSISBRTIHPOLISEMDTEHMDWICIDNMDRIDNRHPHWSKIDNALDTHRTEROUYECDPTURHOFNDVDLHVIGMKMNIGMDROTOBS

// Perceba que teve um aumento no IoC, melhorando ainda mais o texto.

</aside>

### 6.7.3. Plugboard:

<aside>
‚ùì BEST PLUGBOARD SETTING: [EH, AD]
POSSIBLE PLAIN TEXT: POLISHANDBRITISHSOLUTIONSTOENCRYPTEDGERMANENIGMAENIGMATRAFFICRELIEDONSOPHISTICATEDKNOWNPLAINTEXTATTACKSTHEROTORWIRINGWASKNOWNTHROUGHBRILLIANTCRYPTANALYSISBYTHEPOLISHMATHEMATICIANMARIANREJEWSKIANDLATERTHROUGHCAPTUREOFNAVALENIGMAENIGMAROTORS
// Aqui a mensagem original j√° est√° completamente recuperada.

</aside>

### 6.7.4. Observa√ß√µes:

O ataque implementado, mesmo apresentando √≥timos resultados, tem suas limita√ß√µes.

Conforme j√° explicitado nos motivos dos polacos n√£o terem implementado um ataque ciphertext only, a mensagem precisa ter pelo menos 250 caracteres para apresentar bons resultados.

A mensagem apresentada possui esse limite de caracteres, contudo, tem somente 2 conex√µes na plugboard. Caso a mensagem intereceptada tenha mais de 5 plugs, ser√£o necess√°rios mais caracteres para uma an√°lise funcional.

Quando a mensagem √© o caso acima (muitas conex√µes na plugboard), provavalmente o texto final apresentar√° partes corretas e outras nem tanto.

Al√©m disso, como o modelo utilizado foi feito em Ingl√™s, a pontua√ß√£o tamb√©m se d√° na l√≠ngua inglesa. Para que esse ataque decripte mensagens em outras l√≠nguas, seria necess√°rio outros modelos desses idiomas.

### 7. Refer√™ncias:

- **SOLVING THE ENIGMA - HISTORY OF THE CRYPTANALYTIC BOMBE:** [https://media.defense.gov/2022/Sep/29/2003087366/-1/-1/0/SOLVING THE ENIGMA - HISTORY OF THE CRYPTANALYTIC BOMBE.PDF](https://media.defense.gov/2022/Sep/29/2003087366/-1/-1/0/SOLVING%20THE%20ENIGMA%20-%20HISTORY%20OF%20THE%20CRYPTANALYTIC%20BOMBE.PDF)
- **THE ENIGMA HISTORY AND MATHEMATICS BY STEPHANIE FAINT (TESE DE MESTRADO):** [https://core.ac.uk/download/pdf/144149789.pdf](https://core.ac.uk/download/pdf/144149789.pdf)
- **PERMUTATION GROUPS AND THE SOLUTION OF GERMAN ENIGMA CIPHER:** [https://www.karlin.mff.cuni.cz/~tuma/nciphers/oulu.pdf](https://www.karlin.mff.cuni.cz/~tuma/nciphers/oulu.pdf)
- **AN APPLICATION OF THE THEORY OF PERMUTATIONS IN BREAKING THE ENIGMA CIPHER:** [https://www.impan.pl/Great/Rejewski/article.html](https://www.impan.pl/Great/Rejewski/article.html)
- **CIPHERTEXT-ONLY CRYPTANALYSIS OF ENIGMA BY JAMES J. GILLOGLY:** [https://web.archive.org/web/20060720040135/http://members.fortunecity.com/jpeschel/gillog1.htm](https://web.archive.org/web/20060720040135/http://members.fortunecity.com/jpeschel/gillog1.htm)
- **THE ENIGMA MACHINE:** [https://uwillnvrknow.github.io/deCryptMe/pages/enigma.html](https://uwillnvrknow.github.io/deCryptMe/pages/enigma.html)
- **Marie-Jos√© Durand-Richard, Philippe Guillot. From Pozna≈Ñ to Bletchley Park : the history of cracking the ENIGMA machine. CIIT Lab Workshop on History of Cryptography, Faculty of Electronic Engineering, Nis (Serbie), Oct 2017, Nis, Serbia. pp.1-43. ffhalshs-03949790f:** [https://shs.hal.science/halshs-03949790/document](https://shs.hal.science/halshs-03949790/document)
- **CRACKING THE ENIGMA MACHINE - REJEWSKI, TURING AND THE MATH THAT SAVED THE WORLD:** [https://pt.slideshare.net/BradYoung/cracking-the-enigma-machine-rejewski-turing-and-the-math-that-saved-the-world](https://pt.slideshare.net/BradYoung/cracking-the-enigma-machine-rejewski-turing-and-the-math-that-saved-the-world)
- **ZYGALSKI SHEETS:** [https://journal.sciencemuseum.ac.uk/article/zygalski-sheets-polish-codebreaking-and-the-role-of-reconstruction-in-the-top-secret-exhibition-at-the-science-museum/#text-2](https://journal.sciencemuseum.ac.uk/article/zygalski-sheets-polish-codebreaking-and-the-role-of-reconstruction-in-the-top-secret-exhibition-at-the-science-museum/#text-2)
- **ENIGMA ROTOR DETAILS:** [https://en.wikipedia.org/wiki/Enigma_rotor_details#Ring_setting](https://en.wikipedia.org/wiki/Enigma_rotor_details#Ring_setting)
- **ENIGMA MACHINE WITH 256 PIN ROTORS:** [https://www.kopaldev.de/2022/06/13/cryptography-for-everybody-the-ascii-enigma-an-enigma-machine-with-256-pin-rotors/](https://www.kopaldev.de/2022/06/13/cryptography-for-everybody-the-ascii-enigma-an-enigma-machine-with-256-pin-rotors/)